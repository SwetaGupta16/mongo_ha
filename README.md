# mongo_ha
Prerequisites

Edit the group_vars/all file to reflect the below variables.

    Use the provided Vagrant file with VirtualBox to create servers to host the cluster and edit your hosts file to include your new servers, e.g.:

      10.0.0.101      mongo1
      10.0.0.102      mongo2
      10.0.0.103      mongo3
      10.0.0.104      mongo4


    The default directory for storing data is /data, please change it if required. Make sure it has sufficient space: 10G is recommended.

    The secret file at /roles/mongod_replicaset/secret should be replaced with a custom secret, generated by the following command. See documentation at https://docs.mongodb.org/manual/tutorial/generate-key-file/

    openssl rand -base64 741 > secret

Deployment Example

The inventory file looks as follows:

[mongo_servers]
mongo1 mongod_port=27017
mongo2 mongod_port=27017
mongo3 mongod_port=27017
mongo4 mongod_port=27017
mongo5 mongod_port=27017

[mongod_primary]
mongo1 mongod_port=27017

[mongod_slaves]
mongo2 mongod_port=27017
mongo3 mongod_port=27017
mongo4 mongod_port=27017

[mongod_arbiters]
mongo5

Build the site with the following command:

ansible-playbook -i hosts mongo_master.yml -u root -k

Verifying the Deployment

Once configuration and deployment has completed we can check replication set availability by connecting to individual primary replication set nodes:

    mongo --host mongo1 --port 27017
